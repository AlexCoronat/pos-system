<div class="recovery-container">
  <div class="recovery-wrapper">
    <p-card styleClass="recovery-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <div class="logo-container">
            <i class="pi pi-lock" style="font-size: 3rem; color: var(--primary-color);"></i>
          </div>
          <h2>Recuperar Contraseña</h2>
          <p class="subtitle">Ingresa tu email para recibir instrucciones</p>
        </div>
      </ng-template>

      @if (!emailSent) {
        <form [formGroup]="recoveryForm" (ngSubmit)="onSubmit()">
          <div class="field">
            <label for="email" class="block mb-2">
              Email <span class="required">*</span>
            </label>
            <span class="p-input-icon-left w-full">
              <i class="pi pi-envelope"></i>
              <input
                id="email"
                type="email"
                pInputText
                formControlName="email"
                placeholder="correo@ejemplo.com"
                class="w-full"
                [class.p-invalid]="hasError('email', 'required') || hasError('email', 'email')"
                autocomplete="email"
              />
            </span>
            <small
              class="p-error block mt-1"
            >
              @if (hasError('email', 'required') || hasError('email', 'email')) {
                {{ getErrorMessage('email') }}
              }
            </small>
          </div>

          <div class="field">
            <p-button
              type="submit"
              label="Enviar enlace de recuperación"
              icon="pi pi-send"
              [loading]="loading"
              [disabled]="loading"
              styleClass="w-full p-button-lg"
            ></p-button>
          </div>

          <div class="field text-center">
            <a
              class="back-link"
              (click)="goToLogin()"
              tabindex="0"
            >
              <i class="pi pi-arrow-left mr-2"></i>
              Volver al inicio de sesión
            </a>
          </div>
        </form>
      }

      @if (emailSent) {
        <div class="success-message">
          <div class="success-icon">
            <i class="pi pi-check-circle" style="font-size: 4rem; color: var(--green-500);"></i>
          </div>
          <h3>Email enviado exitosamente</h3>
          <p>
            Hemos enviado un enlace de recuperación a tu correo electrónico.
            Por favor revisa tu bandeja de entrada y sigue las instrucciones.
          </p>
          <p class="note">
            Si no recibes el email en unos minutos, revisa tu carpeta de spam.
          </p>
          <div class="field mt-4">
            <p-button
              label="Volver al inicio de sesión"
              icon="pi pi-arrow-left"
              (onClick)="goToLogin()"
              styleClass="w-full"
            ></p-button>
          </div>
        </div>
      }
    </p-card>

    <div class="recovery-footer">
      <p>&copy; 2024 Sistema POS - Papelería. Todos los derechos reservados.</p>
    </div>
  </div>
</div>

<p-toast position="top-right" [life]="5000"></p-toast>
