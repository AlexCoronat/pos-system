<div class="change-password-container">
  <div class="change-password-wrapper">
    <p-card styleClass="change-password-card">
      <ng-template pTemplate="header">
        <div class="card-header">
          <div class="logo-container">
            <i class="pi pi-shield" style="font-size: 3rem; color: var(--primary-color);"></i>
          </div>
          <h2>Cambiar Contraseña</h2>
          <p class="subtitle">Actualiza tu contraseña de forma segura</p>
        </div>
      </ng-template>

      <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
        <div class="field">
          <label for="currentPassword" class="block mb-2">
            Contraseña Actual <span class="required">*</span>
          </label>
          <span class="p-input-icon-left p-input-icon-right w-full">
            <i class="pi pi-lock"></i>
            <input
              id="currentPassword"
              [type]="showCurrentPassword ? 'text' : 'password'"
              pInputText
              formControlName="currentPassword"
              placeholder="Ingrese su contraseña actual"
              class="w-full"
              [class.p-invalid]="hasError('currentPassword', 'required') || hasError('currentPassword', 'minlength')"
              autocomplete="current-password"
            />
            <i
              [class]="showCurrentPassword ? 'pi pi-eye-slash' : 'pi pi-eye'"
              (click)="togglePasswordVisibility('current')"
              style="cursor: pointer;"
            ></i>
          </span>
          <small
            class="p-error block mt-1"
          >
            @if (hasError('currentPassword', 'required') || hasError('currentPassword', 'minlength')) {
              {{ getErrorMessage('currentPassword') }}
            }
          </small>
        </div>

        <div class="field">
          <label for="newPassword" class="block mb-2">
            Nueva Contraseña <span class="required">*</span>
          </label>
          <span class="p-input-icon-left p-input-icon-right w-full">
            <i class="pi pi-lock"></i>
            <input
              id="newPassword"
              [type]="showNewPassword ? 'text' : 'password'"
              pInputText
              formControlName="newPassword"
              placeholder="Ingrese su nueva contraseña"
              class="w-full"
              [class.p-invalid]="hasError('newPassword', 'required') || hasError('newPassword', 'minlength') || hasError('newPassword', 'passwordStrength')"
              autocomplete="new-password"
            />
            <i
              [class]="showNewPassword ? 'pi pi-eye-slash' : 'pi pi-eye'"
              (click)="togglePasswordVisibility('new')"
              style="cursor: pointer;"
            ></i>
          </span>
          <small
            class="p-error block mt-1"
          >
            @if (hasError('newPassword', 'required') || hasError('newPassword', 'minlength') || hasError('newPassword', 'passwordStrength')) {
              {{ getErrorMessage('newPassword') }}
            }
          </small>
          <small class="block mt-1 text-muted">
            La contraseña debe contener al menos 6 caracteres, incluyendo mayúsculas, minúsculas, números y caracteres especiales.
          </small>
        </div>

        <div class="field">
          <label for="confirmPassword" class="block mb-2">
            Confirmar Nueva Contraseña <span class="required">*</span>
          </label>
          <span class="p-input-icon-left p-input-icon-right w-full">
            <i class="pi pi-lock"></i>
            <input
              id="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
              pInputText
              formControlName="confirmPassword"
              placeholder="Confirme su nueva contraseña"
              class="w-full"
              [class.p-invalid]="hasError('confirmPassword', 'required') || hasFormError('passwordMismatch')"
              autocomplete="new-password"
            />
            <i
              [class]="showConfirmPassword ? 'pi pi-eye-slash' : 'pi pi-eye'"
              (click)="togglePasswordVisibility('confirm')"
              style="cursor: pointer;"
            ></i>
          </span>
          <small
            class="p-error block mt-1"
          >
            @if (hasError('confirmPassword', 'required')) {
              {{ getErrorMessage('confirmPassword') }}
            }
          </small>
          <small
            class="p-error block mt-1"
          >
            @if (hasFormError('passwordMismatch')) {
              Las contraseñas no coinciden
            }
          </small>
        </div>

        <div class="field">
          <p-button
            type="submit"
            label="Cambiar Contraseña"
            icon="pi pi-check"
            [loading]="loading"
            [disabled]="loading"
            styleClass="w-full p-button-lg"
          ></p-button>
        </div>

        <div class="field text-center">
          <a
            class="back-link"
            (click)="goBack()"
            tabindex="0"
          >
            <i class="pi pi-arrow-left mr-2"></i>
            Cancelar
          </a>
        </div>
      </form>
    </p-card>

    <div class="change-password-footer">
      <p>&copy; 2024 Sistema POS - Papelería. Todos los derechos reservados.</p>
    </div>
  </div>
</div>

<p-toast position="top-right" [life]="5000"></p-toast>
